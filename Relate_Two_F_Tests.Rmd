---
title: "Relate_Two_F_Tests"
author: "Jingyang(Judy) Zhang"
date: "11/11/2021"
output: 
  html_document:
      code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Load Packages and External R Scripts
```{r load_pkg_source, message = FALSE}
source("F_Test_Power_Mean_Functions.R")
source("F_Test_Power_Variance_Functions.R")
library(pwr)
library(tidyverse)
```



# Introduction

## Setup

Treatment Group Sample Observations: $Y_{1j}\stackrel{iid}\sim N(\mu_{1}, \sigma_{1}^{2})$, $j = 1, ..., n_{1}$.

Control Group Sample Observations: $Y_{0j}\stackrel{iid}\sim N(\mu_{0}, \sigma_{0}^{2})$, $j = 1, ..., n_{0}$.

Total Number of Groups: $k = 2$

Total Number of Observations: $N = \sum_{i=1}^{k}n_{i} = 2n$


Effect Size:

We will use standardized mean difference ($\delta$) as the effect size:

$\delta = \frac{\mu_{1} - \mu_{0}}{\sigma}$

**Assumptions:**

1. Two populations (i.e. treatment group and control group) are independent.

2. Assume equal sample size: $n_{0} = n_{1} = n$.



# Calculate Sample Sizes

**We are going to calculate sample sizes required for a F-Test for equality of population means (which is equivalent to a two sample t-test for equality of population means when there are only two independent groups) to obtain a power of 80%, given $\alpha = 0.5$ and a set of different effect sizes (standardized mean differences: $\delta = \frac{\mu_{1} - \mu_{0}}{\sigma}).**

**Assumption:**

1. Assume equal population variances $\sigma^{2}_{0} = \sigma^{2}_{1} = \sigma^{2}$.

2. Assume we are conducting a two-sided F-test/t-Test for equality of population means. 

$H_{0}: \mu_{0} = \mu_{1}$

$H_{a}: \mu_{0}\neq \mu_{1}$


**Test Data:**


$\sigma^{2} = 1$

$\mu_{0} = 0, 0, 0, 0, 0$

$\mu_{1} = 0.1, 0.2, 0.3, 0.4, 0.5$

The above setup will result in effect sizes 
$\delta = \frac{\mu_{1} - \mu_{0}}{\sigma} = 0.1, 0.2, 0.3, 0.4, 0.5$

$\alpha = 0.05$

$\text{Power} = 0.5, 0.6, 0.7, 0.8$

```{r cal_sample_size_mean}

deltas <- seq(0.1, 0.5, by = 0.1)

powers <- c(0.5, 0.6, 0.7, 0.8)

alpha <- 0.05

ns_mean <- list()

for(i in 1:length(powers)){
  
  ns <- c()
  
  for(j in 1:length(deltas)){
  
    
    
    n_mean <- cal_sampleSize_mean(deltas[j], powers[i], alpha)
    
    ns[j] <- n_mean
    

  }
  
  ns_mean[[i]] <- ns
  
}

powers_result <- list()

for(i in 1:length(powers)){
  
  powers_level <- rep(powers[i], length(deltas))
  powers_result[[i]] <- powers_level
}

powers_result <- unlist(powers_result)


meanTest_power50to80_sampleSizes <- tibble(Power = powers_result, Effect_Size = rep(deltas, length(powers)), Sample_Size_per_Group = unlist(ns_mean))




meanTest_power50to80_sampleSizes

```



*Validation* 
Calculate sample size using the formula:

$n\approx\frac{4(t_{\text{crit}}+t_{1-\beta})}{\delta^2_a}$,

where $\delta_a = \frac{\mu_a}{\sigma} = \frac{\mu_1 - \mu_0}{\sigma}$ is the effect size (measured by the standardized mean difference),

where $\sigma^2$ is the shared population variance of the treatment group and the control group. 


Note: as $t_{\text{crit}}$ and $t_{1-\beta}$ are both functions of sample size $n$ (via d.f.), we will use z-scores (quantiles for standardized normal distribution $N(0,1)$) to approximate them as for large sample sizes (i.e. large d.f.s), t distribution is very close to the standard normal distribution. That is, we will use $z_{\text{crit}}$ and $z_{1-\beta}$ instead. 

```{r sampleSize_mean_validation}

deltas <- seq(0.1, 0.5, by = 0.1)

powers <- c(0.5, 0.6, 0.7, 0.8)

alpha <- 0.05

  
z_crit <- qnorm(1-alpha/2, mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE)

z_ps <- c()

for(i in 1:length(powers)){
  
  z_ps[i] <- qnorm(powers[i], mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE)
  
}


ns <- tibble()

for(i in 1:length(z_ps)){
  
  for(j in 1:length(deltas)){
    
    ns[i, j] <- round(4*(z_crit + z_ps[i])/(deltas[j])^2)
    
  }
  
}

meanTest_power50to80_sampleSizes_valid <- ns %>% pivot_longer(c("...1", "...2", "...3", "...4", "...5"), names_to = "Delta", values_to = "Sample_Size_per_Group") %>%
  mutate(
    Effect_Size = case_when(
      Delta == "...1" ~ 0.1,
      Delta == "...2" ~ 0.2,
      Delta == "...3" ~ 0.3, 
      Delta == "...4" ~ 0.4,
      Delta == "...5" ~ 0.5
    ),
    
    Power = c(rep(0.5, 5), rep(0.6, 5), rep(0.7, 5), rep(0.8, 5))
  ) %>%
  
  select (Power, Effect_Size, Sample_Size_per_Group)




meanTest_power50to80_sampleSizes_valid


```







# Calculate Power

**We are going to calculate power of a F-Test for equality of population variances, given $\alpha = 0.05$, a set of different population variances ratios $\phi = \frac{\sigma^{2}_{1}}{\sigma^{2}_{0}}$, and a set of different effect sizes (standardized mean differences: $\delta = \frac{\mu_{1} - \mu_{0}}{\sigma}).**



**Assumption:**

1. Note: we no longer assume equal population means. 

2. Assume we are conducting a two-sided F-test/t-Test for equality of population variances

$H_{0}: \frac{\sigma^{2}_{1}}{\sigma^{2}_{0}} = 1\Rightarrow \sigma^{2}_{0} = \sigma^{2}_{1}$

$H_{a}: \frac{\sigma^{2}_{1}}{\sigma^{2}_{0}} \neq 1\Rightarrow \sigma^{2}_{0} \neq \sigma^{2}_{1}$


**Test Data:**


$\sigma^{2}_{0} = 1, 1, 1, 1, 1$

$\sigma^{2}_{1} = 1.1, 1.2, 1.3, 1.4, 1.5, $

$\mu_{0} = 0, 0, 0, 0, 0$

$\mu_{1} = 0.1, 0.2, 0.3, 0.4, 0.5$

The above setup will result in effect sizes 
$\delta = \frac{\mu_{1} - \mu_{0}}{\sigma} = 0.1, 0.2, 0.3, 0.4, 0.5$

The above setup will result in population variance ratios 
$\phi = \frac{\sigma_1^{2}}{\sigma_0^{2}} = 1.1, 1.2, 1.3, 1.4, 1.5, \frac{1}{1.1}, \frac{1}{1.2}, \frac{1}{1.3}, \frac{1}{1.4}, \frac{1}{1.5}$

$\alpha = 0.05$

We will look at power of the F-Test for equality of population variances using sample sizes (per group) calculated above:

$n_{0} = n_{1} = n = 1571, 393, 175, 99, 64$



## Power: delta = 0.1 -> n = 1571

**For delta = 0.1, the minimum sample size per group required for the F-test for equal population means is n = 1571, with these two values We will calculate power for F test for equality of population variance with population variances ratio $\phi = 1.1, 1/1.1, 1.2, 1/1.2, 1.3, 1/1.3, 1.4, 1/1.4, 1.5, 1/1.5$.**

```{r cal_power_variance_mean01}

ns_mean_80 <- meanTest_power50to80_sampleSizes %>% 
            filter(Power == 0.8) %>%
            select (Sample_Size_per_Group) %>% unlist()
          



sigma_sqr1s <- c(1.1, 1/1.1, 1.2, 1/1.2, 1.3, 1/1.3, 1.4, 1/1.4, 1.5, 1/1.5)
sigma_sqr0s <- rep(1, length(sigma_sqr1s))

mu1 <- 0.1
mu0 <- 0 

alphas <- rep(0.05, length(sigma_sqr1s))




result_table_1 <- simulate_power_var(sigma_sqr1s, sigma_sqr0s, rep(ns_mean_80[1], length(sigma_sqr1s)), rep(ns_mean_80[1], length(sigma_sqr1s)), alphas)

result_table_1 <- result_table_1 %>% add_column(delta = rep(0.1, length(sigma_sqr1s)), .before = "phi")

#result_table_1

```



## Power: delta = 0.2 -> n = 393

**For delta = 0.2, the minimum sample size per group required for the F-test for equal population means is n = 393, with these two values We will calculate power for F test for equality of population variance with population variances ratio $\phi = 1.1, 1/1.1, 1.2, 1/1.2, 1.3, 1/1.3, 1.4, 1/1.4, 1.5, 1/1.5$.**

```{r cal_power_variance_mean02}


ns_mean_80 <- meanTest_power50to80_sampleSizes %>% 
            filter(Power == 0.8) %>%
            select (Sample_Size_per_Group) %>% unlist()
 

sigma_sqr1s <- c(1.1, 1/1.1, 1.2, 1/1.2, 1.3, 1/1.3, 1.4, 1/1.4, 1.5, 1/1.5)
sigma_sqr0s <- rep(1, length(sigma_sqr1s))

mu1 <- 0.2
mu0 <- 0 

alphas <- rep(0.05, length(sigma_sqr1s))



result_table_2 <- simulate_power_var(sigma_sqr1s, sigma_sqr0s, rep(ns_mean_80[2], length(sigma_sqr1s)), rep(ns_mean_80[2], length(sigma_sqr1s)), alphas)

result_table_2 <- result_table_2 %>% add_column(delta = rep(0.2, length(sigma_sqr1s)), .before = "phi")

#result_table_2


```




## Power: delta = 0.3 -> n = 175

**For delta = 0.3, the minimum sample size per group required for the F-test for equal population means is n = 175, with these two values We will calculate power for F test for equality of population variance with population variances ratio $\phi = 1.1, 1/1.1, 1.2, 1/1.2, 1.3, 1/1.3, 1.4, 1/1.4, 1.5, 1/1.5$.**

```{r cal_power_variance_mean03}


ns_mean_80 <- meanTest_power50to80_sampleSizes %>% 
            filter(Power == 0.8) %>%
            select (Sample_Size_per_Group) %>% unlist()

sigma_sqr1s <- c(1.1, 1/1.1, 1.2, 1/1.2, 1.3, 1/1.3, 1.4, 1/1.4, 1.5, 1/1.5)
sigma_sqr0s <- rep(1, length(sigma_sqr1s))

mu1 <- 0.3
mu0 <- 0 

alphas <- rep(0.05, length(sigma_sqr1s))




result_table_3 <- simulate_power_var(sigma_sqr1s, sigma_sqr0s, rep(ns_mean_80[3], length(sigma_sqr1s)), rep(ns_mean_80[3], length(sigma_sqr1s)), alphas)

result_table_3 <- result_table_3 %>% add_column(delta = rep(0.3, length(sigma_sqr1s)), .before = "phi")


#result_table_3

```




## Power: delta = 0.4 -> n = 99

**For delta = 0.4, the minimum sample size per group required for the F-test for equal population means is n = 99, with these two values We will calculate power for F test for equality of population variance with population variances ratio $\phi = 1.1, 1/1.1, 1.2, 1/1.2, 1.3, 1/1.3, 1.4, 1/1.4, 1.5, 1/1.5$.**

```{r cal_power_variance_mean04}

ns_mean_80 <- meanTest_power50to80_sampleSizes %>% 
            filter(Power == 0.8) %>%
            select (Sample_Size_per_Group) %>% unlist()


sigma_sqr1s <- c(1.1, 1/1.1, 1.2, 1/1.2, 1.3, 1/1.3, 1.4, 1/1.4, 1.5, 1/1.5)
sigma_sqr0s <- rep(1, length(sigma_sqr1s))

mu1 <- 0.4
mu0 <- 0 

alphas <- rep(0.05, length(sigma_sqr1s))



result_table_4 <- simulate_power_var(sigma_sqr1s, sigma_sqr0s, rep(ns_mean_80[4], length(sigma_sqr1s)), rep(ns_mean_80[4], length(sigma_sqr1s)), alphas)

result_table_4 <- result_table_4 %>% add_column(delta = rep(0.4, length(sigma_sqr1s)), .before = "phi")


#result_table_4 

```





## Power: delta = 0.5 -> n = 64

**For delta = 0.5, the minimum sample size per group required for the F-test for equal population means is n = 64, with these two values We will calculate power for F test for equality of population variance with population variances ratio $\phi = 1.1, 1/1.1, 1.2, 1/1.2, 1.3, 1/1.3, 1.4, 1/1.4, 1.5, 1/1.5$.**

```{r cal_power_variance_mean05}

ns_mean_80 <- meanTest_power50to80_sampleSizes %>% 
            filter(Power == 0.8) %>%
            select (Sample_Size_per_Group) %>% unlist()



sigma_sqr1s <- c(1.1, 1/1.1, 1.2, 1/1.2, 1.3, 1/1.3, 1.4, 1/1.4, 1.5, 1/1.5)
sigma_sqr0s <- rep(1, length(sigma_sqr1s))

mu1 <- 0.5
mu0 <- 0 

alphas <- rep(0.05, length(sigma_sqr1s))




result_table_5 <- simulate_power_var(sigma_sqr1s, sigma_sqr0s, rep(ns_mean_80[5], length(sigma_sqr1s)), rep(ns_mean_80[5], length(sigma_sqr1s)), alphas)

result_table_5 <- result_table_5 %>% add_column(delta = rep(0.5, length(sigma_sqr1s)), .before = "phi")


#result_table_5



```




**Combine All Tables**

```{r combine_all_tibbles}


result_table <- bind_rows(list(result_table_1, result_table_2, result_table_3,
                               result_table_4, result_table_5))



result_table


```




# Calculate Population Variance Ratio ($\phi$)


## 80% Power

**We are going to calculate population variance ratio $\phi$ using sample sizes that would result in a power of $80\%$ for the F test for equality of population means with effect sizes (standardized mean differences: $\delta = \frac{\mu_{1} - \mu_{0}}{\sigma}) $\delta = 0.1, 0.2, 0.3, 0.4, 0.5$. These are the sample sizes we calculated previously, which are $n = 1571, 393, 175, 99, 64$ per group corresponding to effect sizes $\delta = 0.1, 0.2, 0.3, 0.4, 0.5$.**


```{r phi_p80}

ns_mean_80 <- meanTest_power50to80_sampleSizes %>% 
            filter(Power == 0.8) %>%
            select (Sample_Size_per_Group) %>% unlist()

alpha <- 0.05
power <- 0.8
phi_var_80 <- c()

for(i in 1:length(ns_mean_80)){
  
  phi_var_80[i] <- cal_effectSize_var_num(ns_mean_80[i], ns_mean_80[i], power, alpha)
  
}


# Because of symmetry, the power for phi equals power for 1/phi, we will use thus change it to 1/phi so that all ratios are greater than 1. 
phi_var_80 <- 1/phi_var_80

phi_var_80

```


**Next, using sample size required for the F test for equality of population means to have a power of 80% to calculate minimum detectable effect size $\phi$ required for the F test for equality of population variances to have a power of 80%, 70%, 60%, and 50%.**
```{r}

alpha <- 0.05

# Sample sizes used

ns_mean_80

# Minimum Detectable Phi required for Power of 80%

phi80_mean80 <- phi_var_80

# Minimum Detectable Phi required for Power of 70%


power <- 0.7
phi70_mean80 <- c()

for(i in 1:length(ns_mean_80)){
  
  phi70_mean80[i] <- cal_effectSize_var_num(ns_mean_80[i], ns_mean_80[i], power, alpha)
  
}


# Because of symmetry, the power for phi equals power for 1/phi, we will use thus change it to 1/phi so that all ratios are greater than 1. 
phi70_mean80 <- 1/phi70_mean80

phi70_mean80




# Minimum Detectable Phi required for Power of 60%


power <- 0.6
phi60_mean80 <- c()

for(i in 1:length(ns_mean_80)){
  
  phi60_mean80[i] <- cal_effectSize_var_num(ns_mean_80[i], ns_mean_80[i], power, alpha)
  
}


# Because of symmetry, the power for phi equals power for 1/phi, we will use thus change it to 1/phi so that all ratios are greater than 1. 
phi60_mean80 <- 1/phi60_mean80

phi60_mean80



# Minimum Detectable Phi required for Power of 50%


power <- 0.5
phi50_mean80 <- c()

for(i in 1:length(ns_mean_80)){
  
  phi50_mean80[i] <- cal_effectSize_var_num(ns_mean_80[i], ns_mean_80[i], power, alpha)
  
}


# Because of symmetry, the power for phi equals power for 1/phi, we will use thus change it to 1/phi so that all ratios are greater than 1. 
phi50_mean80 <- 1/phi50_mean80

phi50_mean80





```



## 70% Power

**We are going to calculate population variance ratio $\phi$ using sample sizes that would result in a power of $70\%$ for the F test for equality of population means with effect sizes (standardized mean differences: $\delta = \frac{\mu_{1} - \mu_{0}}{\sigma}) $\delta = 0.1, 0.2, 0.3, 0.4, 0.5$. These are the sample sizes we calculated previously, which are $n = 1235, 310, 138, 78, 50$ per group corresponding to effect sizes $\delta = 0.1, 0.2, 0.3, 0.4, 0.5$.**


```{r}

ns_mean_70 <- meanTest_power50to80_sampleSizes %>% 
            filter(Power == 0.7) %>%
            select (Sample_Size_per_Group) %>% unlist()

alpha <- 0.05
power <- 0.7
phi_var_70 <- c()

for(i in 1:length(ns_mean_70)){
  
  phi_var_70[i] <- cal_effectSize_var_num(ns_mean_70[i], ns_mean_70[i], power, alpha)
  
}

# Because of symmetry, the power for phi equals power for 1/phi, we will use thus change it to 1/phi so that all ratios are greater than 1. 
phi_var_70 <- 1/phi_var_70

phi_var_70

```




## 60% Power

**We are going to calculate population variance ratio $\phi$ using sample sizes that would result in a power of $60\%$ for the F test for equality of population means with effect sizes (standardized mean differences: $\delta = \frac{\mu_{1} - \mu_{0}}{\sigma}) $\delta = 0.1, 0.2, 0.3, 0.4, 0.5$. These are the sample sizes we calculated previously, which are $n = 981, 246, 110, 62, 40$ per group corresponding to effect sizes $\delta = 0.1, 0.2, 0.3, 0.4, 0.5$.**


```{r}

ns_mean_60 <- meanTest_power50to80_sampleSizes %>% 
            filter(Power == 0.6) %>%
            select (Sample_Size_per_Group) %>% unlist()

alpha <- 0.05
power <- 0.6
phi_var_60 <- c()

for(i in 1:length(ns_mean_60)){
  
  phi_var_60[i] <- cal_effectSize_var_num(ns_mean_60[i], ns_mean_60[i], power, alpha)
  
}

# Because of symmetry, the power for phi equals power for 1/phi, we will use thus change it to 1/phi so that all ratios are greater than 1. 
phi_var_60 <- 1/phi_var_60

phi_var_60

```



## 50% Power

**We are going to calculate population variance ratio $\phi$ using sample sizes that would result in a power of $50\%$ for the F test for equality of population means with effect sizes (standardized mean differences: $\delta = \frac{\mu_{1} - \mu_{0}}{\sigma}) $\delta = 0.1, 0.2, 0.3, 0.4, 0.5$. These are the sample sizes we calculated previously, which are $n = 769, 193, 86, 49, 32$ per group corresponding to effect sizes $\delta = 0.1, 0.2, 0.3, 0.4, 0.5$.**


```{r}

ns_mean_50 <- meanTest_power50to80_sampleSizes %>% 
            filter(Power == 0.5) %>%
            select (Sample_Size_per_Group) %>% unlist()

alpha <- 0.05
power <- 0.5
phi_var_50 <- c()

for(i in 1:length(ns_mean_50)){
  
  phi_var_50[i] <- cal_effectSize_var_num(ns_mean_50[i], ns_mean_50[i], power, alpha)
  
}

# Because of symmetry, the power for phi equals power for 1/phi, we will use thus change it to 1/phi so that all ratios are greater than 1. 
phi_var_50 <- 1/phi_var_50

phi_var_50

```







# Visualization I: Power v.s. Sample Size v.s. Phi

## Data Wrangling

**Because the power for F test for equality of population variances remains the same for population variance ratio $\phi$ and its inverse $\frac{1}{\phi}$, we will drop duplicated rows.**

```{r}

result_table_unique <- result_table %>% 
  slice(-seq(2, 50, by = 2)) %>%
  mutate(phi = recode(phi, '1.1' = '1.1 or 1/1.1',
                            '1.2' = '1.2 or 1/1.2',
                            '1.3' = '1.3 or 1/1.3',
                            '1.4' = '1.4 or 1/1.4',
                            '1.5' = '1.5 or 1/1.5'))


#result_table_unique
          
```




```{r}



ggplot(data = result_table_unique, mapping = aes(x = n, y = power, group = phi, color = phi)) + 
  geom_point() +
  geom_line(size = 0.5) +
  geom_hline(yintercept = 0.8, size = 1, linetype = "dashed") +
  scale_x_continuous(name = "Sample Size (per group)", breaks = c(seq(0, 1600, 100), 64, 99, 175, 393, 1571)) +
  scale_y_continuous(name = "Power", breaks = sort(c(seq(0, 1, 0.15), 0.8))) +
  scale_color_manual(name = "Population Variances Ratio", values=c("#B7950B", "#0BB795", "#B387C2", "#FFC300", "#F03A5E")) +
  theme(axis.text.x = element_text(angle = 75, vjust = 0.5, hjust=1,
                                   color = c(rep('black', 17), rep('red', 5))),
        axis.ticks.length.x = unit(0.25, "cm"))

```



**Observations**

1. Power is symmetric for population variances ratio $\phi$: power for $\phi = 1.1$ is the same as the power for $\phi = \frac{1}{1.1}$.


2. For any given population variance ratio $phi$: as sample size increases the power increases but at a decreasing rate. 

3. For any given sample size: the further away the population variance ratio $\phi$ is away from 1 (either less than 1 or greater than 1), the larger the power. 

4. For any given sample size: the further away the population variance ratio $\phi$ is away from 1 (either less than 1 or greater than 1),the larger the rate of change of the power. 



**Implications**

1. For population variance ratio that is further away from 1 (i.e. meaning the two population variances are very different), increase sample size will efficiently increase power (that is, a small change in sample size will result in a big increase in power).

2. For most minimum required sample sizes calculated from F tests for equality of population means with at least a power of 80%, the power for F tests for equality of population variances will not reach 80% except for the following two cases:

a. The population variance ratio is already very further away from 1 (as in the case of $\phi = 1.5 \text{ or } 1/1.5$ and $\phi = 1.4 \text{ or } 1/1.4$) with moderately large sample sizes (as in the case of about 250 samples per group for $\phi = 1.5 \text{ or } 1/1.5$ and about 350 samples per group for $\phi = 1.4 \text{ or } 1/1.4$). 

b. The population variance ratio is NOT very close to 1 (as in the case of $\phi = 1.3 \text{ or } 1/1.3$, $\phi = 1.2 \text{ or } 1/1.2$) with very large sample sizes (as in the case of about 670 samples per group for $\phi = 1.3 \text{ or } 1/1.3$ and about 1225 samples per group for $\phi = 1.2 \text{ or } 1/1.2$).









# Visualization II: Delta v.s. Phi v.s. Power (80%, 70%, 60%, 50%)

## Data Wrangling

```{r}

# Effect size for F test for equality of population means. 
delta_mean <- c(.1,.2,.3,.4,.5) 


# Effect size for F test for equality of population variances with 50% power (using sample size calculated from F test for equality of population means with 50% power)

phi_var_50 

# Effect size for F test for equality of population variances with 60% power (using sample size calculated from F test for equality of population means with 60% power)

phi_var_60

# Effect size for F test for equality of population variances with 70% power (using sample size calculated from F test for equality of population means with 70% power)

phi_var_70

# Effect size for F test for equality of population variances with 80% power (using sample size calculated from F test for equality of population means with 80% power)

phi_var_80

delta_phi_50 <- tibble('delta' = delta_mean, 'phi' = phi_var_50, 'power' = rep(0.5, length(delta_mean)))

delta_phi_60 <- tibble('delta' = delta_mean, 'phi' = phi_var_60, 'power' = rep(0.6, length(delta_mean)))

delta_phi_70 <- tibble('delta' = delta_mean, 'phi' = phi_var_70, 'power' = rep(0.7, length(delta_mean)))

delta_phi_80 <- tibble('delta' = delta_mean, 'phi' = phi_var_80, 'power' = rep(0.8, length(delta_mean)))

phi_delta_dat <- rbind(delta_phi_50, delta_phi_60, delta_phi_70, delta_phi_80)



ggplot(phi_delta_dat, aes(x = delta, y = phi, group = as.factor(power))) + 
  geom_point(aes(color = as.factor(power))) + 
  geom_line(aes(color = as.factor(power))) + 
  scale_x_continuous(name = "Delta (Effect Size for Difference in Means)", breaks = seq(0, 1, 0.1)) +
  scale_y_continuous(name = "Phi (Effect Size for Difference in Variances", breaks = seq(1, 2, 0.2)) + 
  scale_colour_discrete(name = "Power") + 
  ggtitle(label = "Effect Sizes Phi Required for Different Power Levels", subtitle = "F Test for Equality of Population Means and F Test for Equality of Population Variances")
  




```


**Observations**

1. For moderate to large effect size $\delta$ (e.g. $\delta = 0.3, 0.4, 0.5$), the minimum detectable effect size $\phi$ has to be fairly large (e.g. $\phi = 1.5, 1.7, 2$) for the F test for equality of population variances to have at least 50% power. 


# Visualization III: Delta (80%) v.s. Phi (80%, 70%, 60%, 50%)

## Data Wrangling

```{r}

# Effect size for F test for equality of population means. 
delta_mean <- c(.1,.2,.3,.4,.5) 


# Effect size for F test for equality of population variances with 50% power (using sample size calculated from F test for equality of population means with 80% power)

phi50_mean80

# Effect size for F test for equality of population variances with 60% power (using sample size calculated from F test for equality of population means with 80% power)

phi60_mean80

# Effect size for F test for equality of population variances with 70% power (using sample size calculated from F test for equality of population means with 80% power)

phi70_mean80

# Effect size for F test for equality of population variances with 80% power (using sample size calculated from F test for equality of population means with 80% power)

phi80_mean80

delta80_phi80 <- tibble('delta' = delta_mean, 'phi' = phi80_mean80, 'var_power' = rep(0.8, length(delta_mean)))

delta80_phi70 <- tibble('delta' = delta_mean, 'phi' = phi70_mean80, 'var_power' = rep(0.7, length(delta_mean)))

delta80_phi60 <- tibble('delta' = delta_mean, 'phi' = phi60_mean80, 'var_power' = rep(0.6, length(delta_mean)))

delta80_phi50 <- tibble('delta' = delta_mean, 'phi' = phi50_mean80, 'var_power' = rep(0.5, length(delta_mean)))


phi_delta80_dat <- rbind(delta80_phi50, delta80_phi60, delta80_phi70, delta80_phi80)



ggplot(phi_delta80_dat, aes(x = delta, y = phi, group = as.factor(var_power))) + 
  geom_point(aes(color = as.factor(var_power))) + 
  geom_line(aes(color = as.factor(var_power))) + 
  scale_x_continuous(name = "Delta (Effect Size for Difference in Means)", breaks = seq(0, 1, 0.1)) +
  scale_y_continuous(name = "Phi (Effect Size for Difference in Variances", breaks = seq(1, 2, 0.2)) + 
  scale_colour_discrete(name = "Power") + 
  ggtitle(label = "Effect Sizes Phi Required for Different Power Levels with 80% Power of the Mean Test", subtitle = "F Test for Equality of Population Means and F Test for Equality of Population Variances")
  




```

**Observations**

1. For moderate to large effect size $\delta$ (e.g. $\delta = 0.3, 0.4, 0.5$), the minimum detectable effect size $\phi$ has to be fairly large (e.g. $\phi = 1.5, 1.7, 2$) for the F test for equality of population variances to have at least 50% power. 

