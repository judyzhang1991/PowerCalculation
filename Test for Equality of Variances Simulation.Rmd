---
title: "Test for Equality of Variances Simulation"
author: "Jingyang(Judy) Zhang"
date: "10/6/2021"
output: html_document
---





# A. Simulation 


Set Seed:

```{r}
set.seed(990970215)
```


Generate the following:

Control Group: $N_1 = 1000$, $n_1 = 30$, $X\sim N(\mu_1 = 0, \sigma_1^2 = 1)$.

Treatment Group: $N_2 = 1000$, $n_2 = 30$, $Y\sim N(\mu_2 = 0, \sigma_2^2)$.

Generate population data for the control group: 
```{r}
NX = 1000
sigmaX = 1
muX = 0
X <- rnorm(NX, mean = muX, sd = sigmaX)
```


Generate population data for the treatment group:

```{r}
NY = 1000
sigmaY = 3
muY = 0
Y <- rnorm(NY, mean = muY, sd = sigmaY)
```



Total Number of Iterations: 

```{r}
total_itr <- 1000000
```


Sample $n = 30$ from the control group 10000 Times:
```{r}

nx = 30


x_samples <- list()

sample_means_x <- c()

sample_sds_x <- c()


itr <- 0

while(itr < total_itr){
  
  itr <- itr + 1
  
  x <- sample(X, nx, replace = FALSE)
  
  x_samples[[itr]] <- x
  
  sample_means_x[itr] <- mean(x) 
  
  sample_sds_x[itr] <- sd(x)
  
}




```


Sample $n = 30$ from the treatment group 10000 Times:

```{r}

ny = 30


y_samples <- list()

sample_means_y <- c()

sample_sds_y <- c()


itr <- 0

while(itr < total_itr){
  
  itr <- itr + 1
  
  y <- sample(Y, ny, replace = FALSE)
  
  y_samples[[itr]] <- y
  
  sample_means_y[itr] <- mean(y) 
  
  sample_sds_y[itr] <- sd(y)
  
}
```




B.Statistical Test

1. F Ratio Test for Equality of Two Variances

a. Signifiance Level
```{r}

alpha <- 0.05

```



b. Calculate F Test Statistic
```{r}

F_stats <- c()

test_num <- 0

total_test_num <- length(x_samples)

while(test_num < total_test_num){
  
  test_num <- test_num + 1
    
    F_stats[test_num] <- (sample_sds_x[test_num]^2)/(sample_sds_y[test_num]^2)
  
  
  
}



```


c. Calculate F Critical Value

(1) Lower One-Sided Test

$H_a: \sigma_X^2 < \sigma_Y^2 \Rightarrow \frac{\sigma_X^2}{\sigma_Y^2} < 1$

```{r}
F_crit_low <- qf(alpha, nx-1, ny-1, lower.tail = TRUE, log.p = FALSE)
```


(2) Upper One-Sided Test

$H_a: \sigma_X^2 > \sigma_Y^2 \Rightarrow \frac{\sigma_X^2}{\sigma_Y^2} > 1$

```{r}
F_crit_up <- qf(1-alpha, nx-1, ny-1, lower.tail = TRUE, log.p = FALSE)
```


(3) Two-Sided Test

```{r}
F_crit_two <- c()

F_crit_two_low <- qf(alpha/2, nx-1, ny-1, lower.tail = TRUE, log.p = FALSE)

F_crit_two_up <- qf(1-alpha/2, nx-1, ny-1, lower.tail = TRUE, log.p = FALSE)

F_crit_two[1] <- F_crit_two_low

F_crit_two[2] <- F_crit_two_up
```



d. Make Decision

Reject $H_0$ will be coded as $1$.
Fail to reject $H_0$ will be coded as $0$.

(1) One-Sided Test

First determine which of the one-sided test to use:

```{r}
onesided_test_decision <- c()

for(i in (1:length(F_stats))){
  
  #If sample variance of the control group is less than the treatment group: use lower one-sided test.
  
  if(sample_sds_x[i]^2 < sample_sds_y[i]^2){
    
     if(F_stats[i] <= F_crit_low){
    
        # Reject H0
        onesided_test_decision[i] <- 1
     }
    else{
    
        # Fail to reject H0
        onesided_test_decision[i] <- 0
    }
    
  }
  #If sample variance of the control group is greater than the treatment group: use upper one-sided test.
  else{
    
    if(F_stats[i] >= F_crit_up){
    
        onesided_test_decision[i] <- 1
     }
    else{
    
        onesided_test_decision[i] <- 0
    }
    
    
  }
  
 
}

```




(2) Two-Sided Test

```{r}
twosided_test_decision <- c()

for(i in (1:length(F_stats))){
  
  if(F_stats[i] <= F_crit_two[1] | F_stats[i] >= F_crit_two[2]){
    
    twosided_test_decision[i] <- 1
  }
  else{
    
    twosided_test_decision[i] <- 0
  }
}

```


e. Calculate Empirical Power

As the truth is always set that $\sigma_1^2\neq\sigma_2^2$, the empirical power of the F ratio test will be given by:

Empirical Power = Number of Times $H_0$ Rejected (sum of test decision)/Total Number of Times Test Ran (test_num)

To determine which test to use: 

If sample variance of the control group is LESS than the sample variance of the treatment group (i.e. $s_X^2 < s_6^2$), use the lower one-sided test (i.e. $H_a: \sigma_X^2 < \sigma_Y^2\Rightarrow\frac{\sigma_X^2}{\sigma_Y^2} < 1$).

If sample variance of the control group is GREATER than the sample variance of the treatment group (i.e. $s_X^2 > s_6^2$), use the upper one-sided test (i.e. $H_a: \sigma_X^2 > \sigma_Y^2\Rightarrow\frac{\sigma_X^2}{\sigma_Y^2} > 1$).



(1) Lower One-Sided Test
```{r}

#

emp_power_low <- sum(lower_test_decision)/test_num


```




(2) Upper One-Sided Test
```{r}

#

emp_power_up <- sum(upper_test_decision)/test_num




```



(3) Two-Sided Test
```{r}

#

emp_power_two <- sum(twosided_test_decision)/test_num


```
2. Levene's Test for Equality of Variances